!function(e,t){"function"==typeof define&&define.amd?define([],t(e)):"object"==typeof exports?module.exports=t(e):e.ContaoFineUploaderFrontend=t(e)}("undefined"!=typeof global?global:this.window||this.global,function(e){"use strict";function t(e,t,i){this.container=e,this.config=t,i=i||{},this.settings=JSON.parse(JSON.stringify(a));for(var o in i)i.hasOwnProperty(o)&&(this.settings[o]=i[o]);this.initUploader(),this.makeSortable()}var a={ajaxActionName:"fineuploader_reload",errorMessage:""};return t.prototype={initUploader:function(){this.config.configCallback=this.configCallback.bind(this),this.uploader=new ContaoFineUploader(this.container,this.config),this.uploader.initFineUploader()},configCallback:function(e){e.callbacks.onComplete=this.onCompleteCallback.bind(this)},makeSortable:function(){var e=this.uploader.ajaxContainer.querySelector(".sortable");null!==e&&new Sortable(e,{dataIdAttr:"data-item-id",store:{get:function(){return this.uploader.field.value.split(",")}.bind(this),set:function(e){this.uploader.field.value=e.toArray().join(",")}.bind(this)}})},onCompleteCallback:function(e,t,a){if(a.success&&(this.uploader.onComplete.apply(this.uploader,arguments),!(this.uploader.fineUploader.getInProgress()>0))){this.uploader.ajaxContainer.classList.add("ajax-loading");var i=new XMLHttpRequest;i.open("POST",window.location.href,!0),i.setRequestHeader("Content-Type","application/x-www-form-urlencoded; charset=UTF-8"),i.setRequestHeader("X-Requested-With","XMLHttpRequest"),i.onload=function(){i.status>=200&&i.status<400?(this.uploader.setAjaxContainerContent(i.response),this.makeSortable()):alert(this.settings.errorMessage),this.uploader.ajaxContainer.classList.remove("ajax-loading")}.bind(this),i.onerror=function(){alert(this.settings.errorMessage),this.uploader.ajaxContainer.classList.remove("ajax-loading")}.bind(this),i.send("action="+this.settings.ajaxActionName+"&name="+this.uploader.field.name+"&value="+this.uploader.currentValue+"&REQUEST_TOKEN="+this.uploader.field.form.querySelector('input[name="REQUEST_TOKEN"]').value)}}},t});