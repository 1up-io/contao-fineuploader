/**
 * fineuploader extension for Contao Open Source CMS
 *
 * @copyright  Copyright (c) 2008-2014, terminal42 gmbh
 * @author     terminal42 gmbh <info@terminal42.ch>
 * @license    http://opensource.org/licenses/lgpl-3.0.html LGPL
 * @link       http://github.com/terminal42/contao-fineuploader
 */
;var ContaoFineUploader={};(function(){var b={};ContaoFineUploader.init=function(f,d,c){b[d.field]=document.getElementById("ctrl_"+d.field).value;var g={element:f,debug:false,request:{endpoint:window.location.href,inputName:d.field+"_fineuploader",params:{action:"fineuploader_upload",name:d.field,REQUEST_TOKEN:d.request_token}},chunking:{enabled:d.chunking?true:false,partSize:d.chunkSize},failedUploadTextDisplay:{mode:"custom",maxChars:1000,responseProperty:"error"},validation:{allowedExtensions:d.extensions,sizeLimit:d.sizeLimit},text:{formatProgress:d.labels.text.formatProgress,failUpload:d.labels.text.failUpload,waitingForResponse:d.labels.text.waitingForResponse,paused:d.labels.text.paused,},messages:{tooManyFilesError:d.labels.messages.tooManyFilesError,unsupportedBrowser:d.labels.messages.unsupportedBrowser,},retry:{autoRetryNote:d.labels.retry.autoRetryNote,},deleteFile:{confirmMessage:d.labels.deleteFile.confirmMessage,deletingStatusText:d.labels.deleteFile.deletingStatusText,deletingFailedText:d.labels.deleteFile.deletingFailedText,},paste:{namePromptMessage:d.labels.paste.namePromptMessage,},callbacks:{onValidateBatch:function(i){var h=(b[d.field]=="")?0:b[d.field].split(",").length;if(d.limit==1&&i.length==1&&h==1){h=0;b[d.field]="";this.clearStoredFiles()}if(d.limit>0&&d.limit<(h+i.length)){this._batchError(this._options.messages.tooManyItemsError.replace(/\{netItems\}/g,h+i.length).replace(/\{itemLimit\}/g,d.limit));return false}},onUpload:function(){if(d.backend){AjaxRequest.displayBox(Contao.lang.loading+" â€¦")}},onComplete:function(j,i,h){if(!h.success){if(d.backend){AjaxRequest.hideBox()}return}if(h.file){b[d.field]=(b[d.field].length?(b[d.field]+","):"")+h.file}if(this.getInProgress()>0){return}if(d.backend){new Request.Contao({field:document.getElementById("ctrl_"+d.field),evalScripts:false,onSuccess:function(k,l){document.getElementById("ctrl_"+d.field).getParent("div").set("html",l.content);l.javascript&&Browser.exec(l.javascript);AjaxRequest.hideBox();window.fireEvent("ajax_change")}}).post({action:"fineuploader_reload",name:d.field,value:b[d.field],REQUEST_TOKEN:d.request_token})}else{document.getElementById("ctrl_"+d.field).value=b[d.field]}}}};for(var e in c){g[e]=c[e]}return new qq.FineUploader(g)};ContaoFineUploader.deleteItem=function(c,f){var d=c.parentNode;var e=d.getAttribute("data-id");a(document.getElementById("ctrl_"+f),e);d.parentNode.removeChild(d)};ContaoFineUploader.makeSortable=function(f,d){var c;var e=new Sortables(document.getElementById(f),{contstrain:true,opacity:0.6}).addEvent("complete",function(){var h=[],g=document.getElementById(f).getChildren("li");for(c=0;c<g.length;c++){h.push(g[c].get("data-id"))}document.getElementById(d).value=h.join(",")});e.fireEvent("complete")};var a=function(d,e){var f=d.value.split(",");var c;for(c=0;c<f.length;c++){if(f[c]==e){f.splice(c,1);break}}b[d.id]=f.join(",");d.value=b[d.id]}})();